//@version=5
indicator("üöÄ Penny Stock Explosive Breakout Scanner", overlay=true, max_labels_count=500)

//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  PENNY STOCK OPTIMIZATION SETTINGS
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Volume Settings (Critical for penny stocks)
volMultiplier = input.float(3.0, "Volume Surge Multiplier", minval=1.5, maxval=10.0, step=0.5, 
     tooltip="Penny stocklarda 3x+ volume o'sishi kuchli signal")
volLength = input.int(20, "Volume Average Period", minval=10, maxval=50)

// Price Action Settings
consolidationBars = input.int(10, "Consolidation Period", minval=5, maxval=20,
     tooltip="Qancha bar sideways harakatdan keyin breakout kutiladi")
breakoutThreshold = input.float(2.0, "Breakout % Threshold", minval=0.5, maxval=5.0, step=0.1,
     tooltip="Konsolidatsiyadan qancha % yuqori yopilish kerak")

// Momentum Settings
rsiPeriod = input.int(14, "RSI Period", minval=7, maxval=21)
rsiBuyZone = input.int(40, "RSI Buy Zone Max", minval=30, maxval=60,
     tooltip="RSI bu qiymatdan past bo'lsa, momentum boshlanishi ehtimoli yuqori")

// Gap Settings
gapPercent = input.float(3.0, "Minimum Gap %", minval=1.0, maxval=10.0, step=0.5,
     tooltip="Gap up necha % dan yuqori bo'lishi kerak")

// Multi-Timeframe Trend
htfTrend = input.timeframe("D", "Higher Timeframe for Trend")

// Alert Sensitivity
signalStrength = input.string("Medium", "Signal Strength", options=["Conservative", "Medium", "Aggressive"],
     tooltip="Conservative=kam signal lekin ishonchli, Aggressive=ko'p signal")

//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  CORE CALCULATIONS
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Volume Analysis
avgVol = ta.sma(volume, volLength)
volSurge = volume >= avgVol * volMultiplier
volRatio = volume / avgVol

// Price Action
priceChange = (close - open) / open * 100
bodySize = math.abs(close - open)
candleRange = high - low
bodyPercent = candleRange > 0 ? bodySize / candleRange : 0

// Strong Bullish Candle
strongBullCandle = close > open and bodyPercent > 0.6 and priceChange > 1.5

// Gap Detection
prevClose = close[1]
gapUp = open > prevClose * (1 + gapPercent/100)
gapSize = gapUp ? (open - prevClose) / prevClose * 100 : 0

// Consolidation Detection
highestHigh = ta.highest(high, consolidationBars)
lowestLow = ta.lowest(low, consolidationBars)
consolidationRange = highestHigh - lowestLow
avgPrice = (highestHigh + lowestLow) / 2
consolidationPercent = avgPrice > 0 ? (consolidationRange / avgPrice * 100) : 0

// Tight consolidation before breakout
tightConsolidation = consolidationPercent < 5.0 and consolidationPercent > 0
breakoutFromConsolidation = close > highestHigh * (1 + breakoutThreshold/100)

// RSI Momentum
rsi = ta.rsi(close, rsiPeriod)
rsiLow = rsi < rsiBuyZone
rsiTurning = rsi > rsi[1] and rsi[1] > rsi[2] // RSI o'sish boshlanmoqda

// Higher Timeframe Trend
htfClose = request.security(syminfo.tickerid, htfTrend, close)
htfSma20 = request.security(syminfo.tickerid, htfTrend, ta.sma(close, 20))
htfSma50 = request.security(syminfo.tickerid, htfTrend, ta.sma(close, 50))
htfBullish = htfClose > htfSma20 and htfSma20 > htfSma50

// Moving Average Analysis (Short-term trend)
sma10 = ta.sma(close, 10)
sma20 = ta.sma(close, 20)
ema8 = ta.ema(close, 8)

priceAboveSMA = close > sma10 and sma10 > sma20
goldenCross = ta.crossover(sma10, sma20)

// Accumulation Detection (Price stable, volume increasing)
priceFlat = ta.stdev(close, 10) < close * 0.03 // 3% dan kam o'zgarish
volumeIncreasing = avgVol > ta.sma(volume, volLength * 2)
accumulation = priceFlat and volumeIncreasing and volSurge

//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  SIGNAL SCORING SYSTEM
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Score calculation (0-100)
var float signalScore = 0.0

scoreVolume = volSurge ? 25.0 : 0.0
scorePrice = strongBullCandle ? 20.0 : 0.0
scoreBreakout = breakoutFromConsolidation ? 20.0 : 0.0
scoreRSI = (rsiLow and rsiTurning) ? 15.0 : 0.0
scoreHTF = htfBullish ? 10.0 : 0.0
scoreGap = gapUp ? 10.0 : 0.0

signalScore := scoreVolume + scorePrice + scoreBreakout + scoreRSI + scoreHTF + scoreGap

// Signal Threshold
thresholdConservative = 70.0
thresholdMedium = 55.0
thresholdAggressive = 40.0

threshold = signalStrength == "Conservative" ? thresholdConservative :
             signalStrength == "Medium" ? thresholdMedium : thresholdAggressive

//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  FINAL SIGNALS
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// BUY CONDITIONS
buyCondition1 = volSurge and strongBullCandle and priceAboveSMA and htfBullish and signalScore >= threshold
buyCondition2 = gapUp and volSurge and close > open and htfBullish and signalScore >= threshold
buyCondition3 = breakoutFromConsolidation and tightConsolidation and volSurge and signalScore >= threshold
buyCondition4 = accumulation and rsiTurning and close > ema8 and signalScore >= threshold
buyCondition5 = goldenCross and volSurge and rsiLow and signalScore >= threshold

primaryBuySignal = buyCondition1 or buyCondition2 or buyCondition3
secondaryBuySignal = buyCondition4 or buyCondition5

// Early Warning (momentum building)
earlyWarning = volumeIncreasing and rsiTurning and close > sma10 and signalScore >= (threshold * 0.7)

//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  VISUALIZATION
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ATR for label positioning
atr = ta.atr(14)
labelOffset = atr * 1.2

// PRIMARY BUY SIGNALS
if primaryBuySignal
    label.new(bar_index, low - labelOffset, 
         text="üöÄ BUY\n" + str.tostring(math.round(signalScore)) + "%", 
         style=label.style_label_up, 
         color=color.new(color.green, 0), 
         textcolor=color.white, 
         size=size.normal,
         tooltip="Volume: " + str.tostring(math.round(volRatio, 1)) + "x\n" +
                 "Gap: " + str.tostring(math.round(gapSize, 1)) + "%\n" +
                 "RSI: " + str.tostring(math.round(rsi, 1)))
    
    // Alert
    alert("üöÄ EXPLOSIVE BUY SIGNAL: " + syminfo.ticker + 
          "\nScore: " + str.tostring(math.round(signalScore)) + 
          "\nVolume: " + str.tostring(math.round(volRatio, 1)) + "x" +
          "\nPrice: $" + str.tostring(close), alert.freq_once_per_bar)

// SECONDARY BUY SIGNALS
if secondaryBuySignal and not primaryBuySignal
    label.new(bar_index, low - labelOffset, 
         text="‚ö°Ô∏è SETUP\n" + str.tostring(math.round(signalScore)) + "%", 
         style=label.style_label_up, 
         color=color.new(color.blue, 0), 
         textcolor=color.white, 
         size=size.small,
         tooltip="Momentum building")

// EARLY WARNING
if earlyWarning and not primaryBuySignal and not secondaryBuySignal
    label.new(bar_index, low - labelOffset * 0.7, 
         text="‚è∞", 
         style=label.style_label_up, 
         color=color.new(color.orange, 70), 
         textcolor=color.white, 
         size=size.tiny,
         tooltip="Watch closely - momentum building\nScore: " + str.tostring(math.round(signalScore)))

//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  BACKGROUND & PLOTS
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// Background color for strong signals
bgcolor(primaryBuySignal ? color.new(color.green, 90) : na, title="Buy Signal Background")
bgcolor(earlyWarning ? color.new(color.orange, 95) : na, title="Warning Background")

// Volume surge visualization
plot(volSurge ? low * 0.995 : na, style=plot.style_circles, color=color.yellow, linewidth=2, title="Volume Surge")

// Consolidation zone
plot(tightConsolidation ? highestHigh : na, color=color.new(color.purple, 50), linewidth=1, title="Consolidation High")
plot(tightConsolidation ? lowestLow : na, color=color.new(color.purple, 50), linewidth=1, title="Consolidation Low")


//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
//  DASHBOARD
//‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

var table dashboard = table.new(position.top_right, 2, 8, 
     bgcolor=color.new(color.black, 85), 
     frame_color=color.gray, 
     frame_width=1)

if barstate.islast
    // Header
    table.cell(dashboard, 0, 0, "Metric", text_color=color.white, bgcolor=color.new(color.gray, 70))
    table.cell(dashboard, 1, 0, "Value", text_color=color.white, bgcolor=color.new(color.gray, 70))
    
    // Metrics
    table.cell(dashboard, 0, 1, "Volume Ratio", text_color=color.white)
    table.cell(dashboard, 1, 1, str.tostring(math.round(volRatio, 1)) + "x", 
         text_color=volSurge ? color.lime : color.white)
    
    table.cell(dashboard, 0, 2, "Signal Score", text_color=color.white)
    table.cell(dashboard, 1, 2, str.tostring(math.round(signalScore)) + "%", 
         text_color=signalScore >= threshold ? color.lime : color.white)
    
    table.cell(dashboard, 0, 3, "RSI", text_color=color.white)
    table.cell(dashboard, 1, 3, str.tostring(math.round(rsi, 1)), 
         text_color=rsiLow ? color.lime : color.white)
    
    table.cell(dashboard, 0, 4, "HTF Trend", text_color=color.white)
    table.cell(dashboard, 1, 4, htfBullish ? "BULL ‚úì" : "BEAR ‚úó", 
         text_color=htfBullish ? color.lime : color.red)
    
    table.cell(dashboard, 0, 5, "Consolidation", text_color=color.white)
    table.cell(dashboard, 1, 5, tightConsolidation ? "YES ‚úì" : "NO", 
         text_color=tightConsolidation ? color.lime : color.white)
    
    table.cell(dashboard, 0, 6, "Gap Size", text_color=color.white)
    table.cell(dashboard, 1, 6, gapUp ? str.tostring(math.round(gapSize, 1)) + "%" : "None", 
         text_color=gapUp ? color.lime : color.white)
    
    table.cell(dashboard, 0, 7, "Signal Status", text_color=color.white)
    signalText = primaryBuySignal ? "üöÄ BUY NOW!" : 
                 secondaryBuySignal ? "‚ö°Ô∏è SETUP" : 
                 earlyWarning ? "‚è∞ WATCH" : "WAIT"
    signalColor = primaryBuySignal ? color.lime : 
                  secondaryBuySignal ? color.blue : 
                  earlyWarning ? color.orange : color.gray
    table.cell(dashboard, 1, 7, signalText, text_color=signalColor)
